{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/apps/web/lib/planet-store.ts"],"sourcesContent":["import { create } from \"zustand\";\nimport type { TileState, Entity } from \"@orbis/shared\";\n\ninterface PlanetState {\n  planetId: string | null;\n  sessionId: string | null;\n  tiles: Record<string, TileState>;\n  entities: Record<string, Entity>;\n  snapshotVersion: number;\n  serverTime: number;\n  connected: boolean;\n  actionMode: \"plant\" | \"water\" | \"build\";\n\n  setConnected: (connected: boolean) => void;\n  setSessionId: (id: string) => void;\n  applySnapshot: (data: {\n    planetId: string;\n    snapshotVersion: number;\n    serverTime: number;\n    tiles: Record<string, TileState>;\n    entities: Record<string, Entity>;\n  }) => void;\n  applyDiff: (data: {\n    seq: number;\n    serverTime: number;\n    tilesChanged: TileState[];\n    entitiesUpsert: Entity[];\n    entitiesRemove: string[];\n  }) => void;\n  setActionMode: (mode: \"plant\" | \"water\" | \"build\") => void;\n  reset: () => void;\n}\n\nconst initialState = {\n  planetId: null,\n  sessionId: null,\n  tiles: {},\n  entities: {},\n  snapshotVersion: 0,\n  serverTime: 0,\n  connected: false,\n  actionMode: \"plant\" as const,\n};\n\nexport const usePlanetStore = create<PlanetState>((set) => ({\n  ...initialState,\n  setConnected: (connected) => set({ connected }),\n  setSessionId: (sessionId) => set({ sessionId }),\n  applySnapshot: (data) =>\n    set({\n      planetId: data.planetId,\n      snapshotVersion: data.snapshotVersion,\n      serverTime: data.serverTime,\n      tiles: data.tiles || {},\n      entities: data.entities || {},\n    }),\n  applyDiff: ({ seq: _seq, serverTime, tilesChanged, entitiesUpsert, entitiesRemove }) =>\n    set((state) => {\n      const tiles = { ...state.tiles };\n      for (const t of tilesChanged || []) {\n        tiles[t.tileId] = t;\n      }\n      const entities = { ...state.entities };\n      for (const e of entitiesUpsert || []) {\n        entities[e.id] = e;\n      }\n      for (const id of entitiesRemove || []) {\n        delete entities[id];\n      }\n      return { tiles, entities, serverTime };\n    }),\n  setActionMode: (actionMode) => set({ actionMode }),\n  reset: () => set(initialState),\n}));\n"],"names":[],"mappings":";;;;AAAA;;AAiCA,MAAM,eAAe;IACnB,UAAU;IACV,WAAW;IACX,OAAO,CAAC;IACR,UAAU,CAAC;IACX,iBAAiB;IACjB,YAAY;IACZ,WAAW;IACX,YAAY;AACd;AAEO,MAAM,iBAAiB,IAAA,+MAAM,EAAc,CAAC,MAAQ,CAAC;QAC1D,GAAG,YAAY;QACf,cAAc,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC7C,cAAc,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC7C,eAAe,CAAC,OACd,IAAI;gBACF,UAAU,KAAK,QAAQ;gBACvB,iBAAiB,KAAK,eAAe;gBACrC,YAAY,KAAK,UAAU;gBAC3B,OAAO,KAAK,KAAK,IAAI,CAAC;gBACtB,UAAU,KAAK,QAAQ,IAAI,CAAC;YAC9B;QACF,WAAW,CAAC,EAAE,KAAK,IAAI,EAAE,UAAU,EAAE,YAAY,EAAE,cAAc,EAAE,cAAc,EAAE,GACjF,IAAI,CAAC;gBACH,MAAM,QAAQ;oBAAE,GAAG,MAAM,KAAK;gBAAC;gBAC/B,KAAK,MAAM,KAAK,gBAAgB,EAAE,CAAE;oBAClC,KAAK,CAAC,EAAE,MAAM,CAAC,GAAG;gBACpB;gBACA,MAAM,WAAW;oBAAE,GAAG,MAAM,QAAQ;gBAAC;gBACrC,KAAK,MAAM,KAAK,kBAAkB,EAAE,CAAE;oBACpC,QAAQ,CAAC,EAAE,EAAE,CAAC,GAAG;gBACnB;gBACA,KAAK,MAAM,MAAM,kBAAkB,EAAE,CAAE;oBACrC,OAAO,QAAQ,CAAC,GAAG;gBACrB;gBACA,OAAO;oBAAE;oBAAO;oBAAU;gBAAW;YACvC;QACF,eAAe,CAAC,aAAe,IAAI;gBAAE;YAAW;QAChD,OAAO,IAAM,IAAI;IACnB,CAAC"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/apps/web/components/Globe.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useMemo, useCallback } from \"react\";\nimport { Canvas, useThree } from \"@react-three/fiber\";\nimport { OrbitControls } from \"@react-three/drei\";\nimport * as THREE from \"three\";\nimport { usePlanetStore } from \"@/lib/planet-store\";\nimport { pointToLatLng } from \"@/lib/latlng\";\nimport type { TreeEntity, StructureEntity } from \"@orbis/shared\";\n\nfunction latLngToVector3(lat: number, lng: number, radius: number) {\n  const phi = ((90 - lat) * Math.PI) / 180;\n  const theta = (lng * Math.PI) / 180;\n  return new THREE.Vector3(\n    radius * Math.sin(phi) * Math.cos(theta),\n    radius * Math.cos(phi),\n    radius * Math.sin(phi) * Math.sin(theta)\n  );\n}\n\nfunction Entities({ radius }: { radius: number }) {\n  const entitiesRecord = usePlanetStore((s) => s.entities);\n  const entities = useMemo(\n    () => Object.values(entitiesRecord),\n    [entitiesRecord]\n  );\n\n  const trees = useMemo(\n    () => entities.filter((e) => e.type === \"tree\") as TreeEntity[],\n    [entities]\n  );\n  const structures = useMemo(\n    () => entities.filter((e) => e.type === \"structure\") as StructureEntity[],\n    [entities]\n  );\n\n  return (\n    <group>\n      {trees.map((tree) => {\n        const pos = latLngToVector3(tree.lat, tree.lng, radius);\n        const scale = 0.015 + tree.growthStage * 0.02;\n        return (\n          <mesh key={tree.id} position={pos}>\n            <coneGeometry args={[scale, scale * 2, 6]} />\n            <meshStandardMaterial color=\"#2d5a27\" />\n          </mesh>\n        );\n      })}\n      {structures.map((struct) => {\n        const pos = latLngToVector3(struct.lat, struct.lng, radius);\n        const scale = 0.02;\n        return (\n          <mesh key={struct.id} position={pos}>\n            <boxGeometry args={[scale, scale * 1.5, scale]} />\n            <meshStandardMaterial color=\"#8b7355\" />\n          </mesh>\n        );\n      })}\n    </group>\n  );\n}\n\nfunction EarthSphere({\n  radius,\n  onPointClick,\n}: {\n  radius: number;\n  onPointClick: (lat: number, lng: number) => void;\n}) {\n  const meshRef = useRef<THREE.Mesh>(null);\n  const { camera } = useThree();\n\n  const handlePointerDown = useCallback(\n    (e: { stopPropagation: () => void; pointer?: { x: number; y: number } }) => {\n      e.stopPropagation();\n      if (!meshRef.current || !e.pointer) return;\n      const result = ndcToLatLng(\n        e.pointer.x,\n        e.pointer.y,\n        camera,\n        meshRef.current\n      );\n      if (result) onPointClick(result.lat, result.lng);\n    },\n    [camera, onPointClick]\n  );\n\n  return (\n    <mesh\n      ref={meshRef}\n      position={[0, 0, 0]}\n      onPointerDown={handlePointerDown}\n      receiveShadow\n    >\n      <sphereGeometry args={[radius, 64, 64]} />\n      <meshStandardMaterial\n        color=\"#1e3a5f\"\n        roughness={0.8}\n        metalness={0.05}\n      />\n    </mesh>\n  );\n}\n\nfunction Scene({\n  onPointClick,\n}: {\n  onPointClick: (lat: number, lng: number) => void;\n}) {\n  const radius = 1;\n\n  return (\n    <>\n      <ambientLight intensity={0.4} />\n      <directionalLight position={[5, 5, 5]} intensity={1} castShadow />\n      <EarthSphere radius={radius} onPointClick={onPointClick} />\n      <Entities radius={radius + 0.02} />\n      <OrbitControls\n        enableZoom\n        enablePan\n        minDistance={1.5}\n        maxDistance={5}\n        autoRotate\n        autoRotateSpeed={0.3}\n      />\n    </>\n  );\n}\n\nexport function Globe({\n  onPointClick,\n}: {\n  onPointClick: (lat: number, lng: number) => void;\n}) {\n  return (\n    <div className=\"absolute inset-0 bg-[#0a0f1a]\">\n      <Canvas\n        camera={{ position: [0, 0, 2.5], fov: 45 }}\n        gl={{ antialias: true }}\n      >\n        <Scene onPointClick={onPointClick} />\n      </Canvas>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 329, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/apps/web/lib/use-planet-ws.ts"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef } from \"react\";\nimport { usePlanetStore } from \"./planet-store\";\nimport type { ClientMessage } from \"@orbis/shared\";\n\nconst getWsUrl = (planetId: string) => {\n  const base = process.env.NEXT_PUBLIC_WS_URL || \"http://localhost:8787\";\n  const wsProtocol = base.startsWith(\"https\") ? \"wss\" : \"ws\";\n  const host = base.replace(/^https?:\\/\\//, \"\");\n  return `${wsProtocol}://${host}/api/ws?planetId=${planetId}`;\n};\n\nexport function usePlanetWebSocket(planetId: string) {\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<ReturnType<typeof setTimeout>>();\n  const reconnectAttempts = useRef(0);\n  const {\n    applySnapshot,\n    applyDiff,\n    setConnected,\n    setSessionId,\n    reset,\n  } = usePlanetStore();\n\n  useEffect(() => {\n    reset();\n    let cancelled = false;\n\n    const connect = () => {\n      if (cancelled) return;\n      const url = getWsUrl(planetId);\n      const ws = new WebSocket(url);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        reconnectAttempts.current = 0;\n        setConnected(true);\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const msg = JSON.parse(event.data as string);\n          if (msg.type === \"WELCOME\") {\n            setSessionId(msg.you?.sessionId || \"\");\n          } else if (msg.type === \"SNAPSHOT\") {\n            applySnapshot({\n              planetId: msg.planetId,\n              snapshotVersion: msg.snapshotVersion,\n              serverTime: msg.serverTime,\n              tiles: msg.tiles || {},\n              entities: msg.entities || {},\n            });\n          } else if (msg.type === \"DIFF\") {\n            applyDiff({\n              seq: msg.seq,\n              serverTime: msg.serverTime,\n              tilesChanged: msg.tilesChanged || [],\n              entitiesUpsert: msg.entitiesUpsert || [],\n              entitiesRemove: msg.entitiesRemove || [],\n            });\n          }\n        } catch {\n          // ignore parse errors\n        }\n      };\n\n      ws.onclose = () => {\n        setConnected(false);\n        if (cancelled) return;\n        const delay = Math.min(1000 * 2 ** reconnectAttempts.current, 30000);\n        reconnectAttempts.current++;\n        reconnectTimeoutRef.current = setTimeout(connect, delay);\n      };\n\n      ws.onerror = () => {\n        ws.close();\n      };\n    };\n\n    connect();\n    return () => {\n      cancelled = true;\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      wsRef.current?.close();\n      wsRef.current = null;\n    };\n  }, [planetId, applySnapshot, applyDiff, setConnected, setSessionId, reset]);\n\n  const send = (msg: ClientMessage) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(msg));\n    }\n  };\n\n  return { send };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAMA,MAAM,WAAW,CAAC;IAChB,MAAM,OAAO,6DAAkC;IAC/C,MAAM,aAAa,KAAK,UAAU,CAAC,WAAW,QAAQ;IACtD,MAAM,OAAO,KAAK,OAAO,CAAC,gBAAgB;IAC1C,OAAO,GAAG,WAAW,GAAG,EAAE,KAAK,iBAAiB,EAAE,UAAU;AAC9D;AAEO,SAAS,mBAAmB,QAAgB;IACjD,MAAM,QAAQ,IAAA,4QAAM,EAAmB;IACvC,MAAM,sBAAsB,IAAA,4QAAM;IAClC,MAAM,oBAAoB,IAAA,4QAAM,EAAC;IACjC,MAAM,EACJ,aAAa,EACb,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,KAAK,EACN,GAAG,IAAA,oNAAc;IAElB,IAAA,+QAAS,EAAC;QACR;QACA,IAAI,YAAY;QAEhB,MAAM,UAAU;YACd,IAAI,WAAW;YACf,MAAM,MAAM,SAAS;YACrB,MAAM,KAAK,IAAI,UAAU;YACzB,MAAM,OAAO,GAAG;YAEhB,GAAG,MAAM,GAAG;gBACV,kBAAkB,OAAO,GAAG;gBAC5B,aAAa;YACf;YAEA,GAAG,SAAS,GAAG,CAAC;gBACd,IAAI;oBACF,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM,IAAI;oBACjC,IAAI,IAAI,IAAI,KAAK,WAAW;wBAC1B,aAAa,IAAI,GAAG,EAAE,aAAa;oBACrC,OAAO,IAAI,IAAI,IAAI,KAAK,YAAY;wBAClC,cAAc;4BACZ,UAAU,IAAI,QAAQ;4BACtB,iBAAiB,IAAI,eAAe;4BACpC,YAAY,IAAI,UAAU;4BAC1B,OAAO,IAAI,KAAK,IAAI,CAAC;4BACrB,UAAU,IAAI,QAAQ,IAAI,CAAC;wBAC7B;oBACF,OAAO,IAAI,IAAI,IAAI,KAAK,QAAQ;wBAC9B,UAAU;4BACR,KAAK,IAAI,GAAG;4BACZ,YAAY,IAAI,UAAU;4BAC1B,cAAc,IAAI,YAAY,IAAI,EAAE;4BACpC,gBAAgB,IAAI,cAAc,IAAI,EAAE;4BACxC,gBAAgB,IAAI,cAAc,IAAI,EAAE;wBAC1C;oBACF;gBACF,EAAE,OAAM;gBACN,sBAAsB;gBACxB;YACF;YAEA,GAAG,OAAO,GAAG;gBACX,aAAa;gBACb,IAAI,WAAW;gBACf,MAAM,QAAQ,KAAK,GAAG,CAAC,OAAO,KAAK,kBAAkB,OAAO,EAAE;gBAC9D,kBAAkB,OAAO;gBACzB,oBAAoB,OAAO,GAAG,WAAW,SAAS;YACpD;YAEA,GAAG,OAAO,GAAG;gBACX,GAAG,KAAK;YACV;QACF;QAEA;QACA,OAAO;YACL,YAAY;YACZ,IAAI,oBAAoB,OAAO,EAAE;gBAC/B,aAAa,oBAAoB,OAAO;YAC1C;YACA,MAAM,OAAO,EAAE;YACf,MAAM,OAAO,GAAG;QAClB;IACF,GAAG;QAAC;QAAU;QAAe;QAAW;QAAc;QAAc;KAAM;IAE1E,MAAM,OAAO,CAAC;QACZ,IAAI,MAAM,OAAO,EAAE,eAAe,UAAU,IAAI,EAAE;YAChD,MAAM,OAAO,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;QACpC;IACF;IAEA,OAAO;QAAE;IAAK;AAChB"}},
    {"offset": {"line": 428, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/packages/shared/src/types.ts"],"sourcesContent":["/**\n * Orbis - Living Digital Planet\n * Shared types for planet state, entities, tiles, and messages.\n */\n\n// --- Tiles ---\n\nexport const TILE_SIZE_DEG = 5;\n\nexport const BIOME_OPTIONS = [\n  \"ocean\",\n  \"desert\",\n  \"grassland\",\n  \"forest\",\n  \"tundra\",\n  \"wetland\",\n] as const;\n\nexport type Biome = (typeof BIOME_OPTIONS)[number];\n\nexport interface TileState {\n  tileId: string;\n  moisture: number; // 0-1\n  fertility: number; // 0-1\n  pollution: number; // 0-1\n  biome: Biome;\n}\n\nexport function tileIdFromLatLng(lat: number, lng: number): string {\n  const latIndex = Math.floor((lat + 90) / TILE_SIZE_DEG);\n  const lngIndex = Math.floor((lng + 180) / TILE_SIZE_DEG);\n  return `${latIndex}:${lngIndex}`;\n}\n\nexport function latLngFromTileId(tileId: string): { lat: number; lng: number } {\n  const [latIdx, lngIdx] = tileId.split(\":\").map(Number);\n  const lat = latIdx * TILE_SIZE_DEG - 90 + TILE_SIZE_DEG / 2;\n  const lng = lngIdx * TILE_SIZE_DEG - 180 + TILE_SIZE_DEG / 2;\n  return { lat, lng };\n}\n\n// --- Entities ---\n\nexport const TREE_SPECIES = [\"oak\", \"pine\", \"birch\", \"willow\", \"maple\"] as const;\nexport type TreeSpecies = (typeof TREE_SPECIES)[number];\n\nexport const STRUCTURE_KINDS = [\"house\", \"well\", \"tower\", \"farm\"] as const;\nexport type StructureKind = (typeof STRUCTURE_KINDS)[number];\n\nexport interface BaseEntity {\n  id: string;\n  type: \"tree\" | \"structure\";\n  lat: number;\n  lng: number;\n  createdAt: number;\n}\n\nexport interface TreeEntity extends BaseEntity {\n  type: \"tree\";\n  species: TreeSpecies;\n  health: number; // 0-1\n  growthStage: number; // 0-1\n}\n\nexport interface StructureEntity extends BaseEntity {\n  type: \"structure\";\n  kind: StructureKind;\n  integrity: number; // 0-1\n}\n\nexport type Entity = TreeEntity | StructureEntity;\n\nexport function isTreeEntity(e: Entity): e is TreeEntity {\n  return e.type === \"tree\";\n}\n\nexport function isStructureEntity(e: Entity): e is StructureEntity {\n  return e.type === \"structure\";\n}\n\n// --- Planet State ---\n\nexport interface PlanetSnapshot {\n  planetId: string;\n  snapshotVersion: number;\n  serverTime: number;\n  tiles: Record<string, TileState>;\n  entities: Record<string, Entity>;\n}\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED,gBAAgB;;;;;;;;;;;;;;;;;;;AAET,MAAM,gBAAgB;AAEtB,MAAM,gBAAgB;IAC3B;IACA;IACA;IACA;IACA;IACA;CACD;AAYM,SAAS,iBAAiB,GAAW,EAAE,GAAW;IACvD,MAAM,WAAW,KAAK,KAAK,CAAC,CAAC,MAAM,EAAE,IAAI;IACzC,MAAM,WAAW,KAAK,KAAK,CAAC,CAAC,MAAM,GAAG,IAAI;IAC1C,OAAO,GAAG,SAAS,CAAC,EAAE,UAAU;AAClC;AAEO,SAAS,iBAAiB,MAAc;IAC7C,MAAM,CAAC,QAAQ,OAAO,GAAG,OAAO,KAAK,CAAC,KAAK,GAAG,CAAC;IAC/C,MAAM,MAAM,SAAS,gBAAgB,KAAK,gBAAgB;IAC1D,MAAM,MAAM,SAAS,gBAAgB,MAAM,gBAAgB;IAC3D,OAAO;QAAE;QAAK;IAAI;AACpB;AAIO,MAAM,eAAe;IAAC;IAAO;IAAQ;IAAS;IAAU;CAAQ;AAGhE,MAAM,kBAAkB;IAAC;IAAS;IAAQ;IAAS;CAAO;AA0B1D,SAAS,aAAa,CAAS;IACpC,OAAO,EAAE,IAAI,KAAK;AACpB;AAEO,SAAS,kBAAkB,CAAS;IACzC,OAAO,EAAE,IAAI,KAAK;AACpB"}},
    {"offset": {"line": 496, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/packages/shared/src/messages.ts"],"sourcesContent":["/**\n * WebSocket message schemas (Zod) for client-server communication.\n */\n\nimport { z } from \"zod\";\n// Re-export for Zod - tree species/kind enums match types\n// --- Server → Client ---\n\nexport const WelcomeMessageSchema = z.object({\n  type: z.literal(\"WELCOME\"),\n  planetId: z.string(),\n  serverTime: z.number(),\n  tickRate: z.number(),\n  you: z.object({ sessionId: z.string() }),\n});\n\nexport const SnapshotMessageSchema = z.object({\n  type: z.literal(\"SNAPSHOT\"),\n  planetId: z.string(),\n  snapshotVersion: z.number(),\n  serverTime: z.number(),\n  tiles: z.record(z.any()),\n  entities: z.record(z.any()),\n});\n\nexport const DiffMessageSchema = z.object({\n  type: z.literal(\"DIFF\"),\n  planetId: z.string(),\n  seq: z.number(),\n  serverTime: z.number(),\n  tilesChanged: z.array(z.any()).optional().default([]),\n  entitiesUpsert: z.array(z.any()).optional().default([]),\n  entitiesRemove: z.array(z.string()).optional().default([]),\n});\n\nexport const RejectedMessageSchema = z.object({\n  type: z.literal(\"REJECTED\"),\n  planetId: z.string(),\n  requestId: z.string(),\n  reason: z.string(),\n});\n\n// --- Client → Server (Intents) ---\n\nexport const IntentPlantTreeSchema = z.object({\n  type: z.literal(\"INTENT_PLANT_TREE\"),\n  requestId: z.string(),\n  planetId: z.string(),\n  lat: z.number().min(-90).max(90),\n  lng: z.number().min(-180).max(180),\n  species: z.enum([\"oak\", \"pine\", \"birch\", \"willow\", \"maple\"]),\n});\n\nexport const IntentWaterTileSchema = z.object({\n  type: z.literal(\"INTENT_WATER_TILE\"),\n  requestId: z.string(),\n  planetId: z.string(),\n  tileId: z.string(),\n  amount: z.number().min(0.01).max(1),\n});\n\nexport const IntentBuildSchema = z.object({\n  type: z.literal(\"INTENT_BUILD\"),\n  requestId: z.string(),\n  planetId: z.string(),\n  lat: z.number().min(-90).max(90),\n  lng: z.number().min(-180).max(180),\n  kind: z.enum([\"house\", \"well\", \"tower\", \"farm\"]),\n});\n\nexport const PingSchema = z.object({\n  type: z.literal(\"PING\"),\n  t: z.number(),\n});\n\nexport const ClientMessageSchema = z.union([\n  IntentPlantTreeSchema,\n  IntentWaterTileSchema,\n  IntentBuildSchema,\n  PingSchema,\n]);\n\nexport type WelcomeMessage = z.infer<typeof WelcomeMessageSchema>;\nexport type SnapshotMessage = z.infer<typeof SnapshotMessageSchema>;\nexport type DiffMessage = z.infer<typeof DiffMessageSchema>;\nexport type RejectedMessage = z.infer<typeof RejectedMessageSchema>;\nexport type IntentPlantTree = z.infer<typeof IntentPlantTreeSchema>;\nexport type IntentWaterTile = z.infer<typeof IntentWaterTileSchema>;\nexport type IntentBuild = z.infer<typeof IntentBuildSchema>;\nexport type PingMessage = z.infer<typeof PingSchema>;\nexport type ClientMessage = z.infer<typeof ClientMessageSchema>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 600, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/packages/shared/src/index.ts"],"sourcesContent":["export * from \"./types\";\nexport * from \"./messages\";\n"],"names":[],"mappings":";AAAA;AACA"}},
    {"offset": {"line": 609, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Humza/OneDrive/Documents/Programming/Personal/orbis/apps/web/app/planet/%5BplanetId%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useMemo } from \"react\";\nimport { useParams } from \"next/navigation\";\nimport { Globe } from \"@/components/Globe\";\nimport { usePlanetWebSocket } from \"@/lib/use-planet-ws\";\nimport { usePlanetStore } from \"@/lib/planet-store\";\nimport { tileIdFromLatLng } from \"@orbis/shared\";\n\nexport default function PlanetPage() {\n  const params = useParams();\n  const planetId = (params?.planetId as string) || \"earth-001\";\n  const { send } = usePlanetWebSocket(planetId);\n  const { actionMode, connected } = usePlanetStore();\n\n  const handlePointClick = useCallback(\n    (lat: number, lng: number) => {\n      if (!connected) return;\n      const requestId = crypto.randomUUID().slice(0, 8);\n      if (actionMode === \"plant\") {\n        send({\n          type: \"INTENT_PLANT_TREE\",\n          requestId,\n          planetId,\n          lat,\n          lng,\n          species: \"oak\",\n        });\n      } else if (actionMode === \"water\") {\n        const tileId = tileIdFromLatLng(lat, lng);\n        send({\n          type: \"INTENT_WATER_TILE\",\n          requestId,\n          planetId,\n          tileId,\n          amount: 0.2,\n        });\n      } else if (actionMode === \"build\") {\n        send({\n          type: \"INTENT_BUILD\",\n          requestId,\n          planetId,\n          lat,\n          lng,\n          kind: \"well\",\n        });\n      }\n    },\n    [connected, actionMode, planetId, send]\n  );\n\n  const setActionMode = usePlanetStore((s) => s.setActionMode);\n\n  return (\n    <div className=\"relative h-screen w-screen overflow-hidden\">\n      <Globe onPointClick={handlePointClick} />\n\n      <div className=\"absolute left-4 top-4 z-10 flex flex-col gap-2\">\n        <div className=\"rounded-lg bg-black/60 px-4 py-2 text-sm text-white backdrop-blur\">\n          {connected ? (\n            <span className=\"text-emerald-400\">● Connected</span>\n          ) : (\n            <span className=\"text-amber-400\">○ Connecting...</span>\n          )}\n        </div>\n        <div className=\"flex gap-2\">\n          {([\"plant\", \"water\", \"build\"] as const).map((mode) => (\n            <button\n              key={mode}\n              onClick={() => setActionMode(mode)}\n              className={`rounded-lg px-4 py-2 text-sm font-medium capitalize transition-colors ${\n                actionMode === mode\n                  ? \"bg-emerald-600 text-white\"\n                  : \"bg-black/40 text-zinc-300 hover:bg-black/60\"\n              }`}\n            >\n              {mode === \"plant\" ? \"Plant Tree\" : mode === \"water\" ? \"Water\" : \"Build\"}\n            </button>\n          ))}\n        </div>\n        <p className=\"max-w-[200px] text-xs text-zinc-500\">\n          Click the globe to {actionMode}. Trees grow over time; water helps them.\n        </p>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAPA;;;;;;;;AASe,SAAS;IACtB,MAAM,SAAS,IAAA,4MAAS;IACxB,MAAM,WAAW,AAAC,QAAQ,YAAuB;IACjD,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,4NAAkB,EAAC;IACpC,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,IAAA,oNAAc;IAEhD,MAAM,mBAAmB,IAAA,iRAAW,EAClC,CAAC,KAAa;QACZ,IAAI,CAAC,WAAW;QAChB,MAAM,YAAY,OAAO,UAAU,GAAG,KAAK,CAAC,GAAG;QAC/C,IAAI,eAAe,SAAS;YAC1B,KAAK;gBACH,MAAM;gBACN;gBACA;gBACA;gBACA;gBACA,SAAS;YACX;QACF,OAAO,IAAI,eAAe,SAAS;YACjC,MAAM,SAAS,IAAA,mNAAgB,EAAC,KAAK;YACrC,KAAK;gBACH,MAAM;gBACN;gBACA;gBACA;gBACA,QAAQ;YACV;QACF,OAAO,IAAI,eAAe,SAAS;YACjC,KAAK;gBACH,MAAM;gBACN;gBACA;gBACA;gBACA;gBACA,MAAM;YACR;QACF;IACF,GACA;QAAC;QAAW;QAAY;QAAU;KAAK;IAGzC,MAAM,gBAAgB,IAAA,oNAAc,EAAC,CAAC,IAAM,EAAE,aAAa;IAE3D,qBACE,2SAAC;QAAI,WAAU;;0BACb,2SAAC,yMAAK;gBAAC,cAAc;;;;;;0BAErB,2SAAC;gBAAI,WAAU;;kCACb,2SAAC;wBAAI,WAAU;kCACZ,0BACC,2SAAC;4BAAK,WAAU;sCAAmB;;;;;iDAEnC,2SAAC;4BAAK,WAAU;sCAAiB;;;;;;;;;;;kCAGrC,2SAAC;wBAAI,WAAU;kCACZ,AAAC;4BAAC;4BAAS;4BAAS;yBAAQ,CAAW,GAAG,CAAC,CAAC,qBAC3C,2SAAC;gCAEC,SAAS,IAAM,cAAc;gCAC7B,WAAW,CAAC,sEAAsE,EAChF,eAAe,OACX,8BACA,+CACJ;0CAED,SAAS,UAAU,eAAe,SAAS,UAAU,UAAU;+BAR3D;;;;;;;;;;kCAYX,2SAAC;wBAAE,WAAU;;4BAAsC;4BAC7B;4BAAW;;;;;;;;;;;;;;;;;;;AAKzC"}}]
}